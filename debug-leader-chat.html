<!DOCTYPE html>
<html>
<head>
    <title>Debug Chat Issue</title>
</head>
<body>
    <h1>Debug: Check Chat Data</h1>
    <button onclick="showCurrentUser()">Show Current User</button>
    <button onclick="showAllConversations()">Show All Conversations</button>
    <button onclick="testLeaderLogin()">Test Leader Login</button>
    <button onclick="clearAllChat()">Clear All Chat Data</button>
    
    <div id="output" style="margin-top: 20px; white-space: pre-wrap; font-family: monospace; background: #f5f5f5; padding: 10px;"></div>

    <script>
        function showCurrentUser() {
            const currentUser = localStorage.getItem('currentUser');
            document.getElementById('output').textContent = 'Current User: ' + currentUser;
        }

        function showAllConversations() {
            let output = 'All Conversation Keys:\n\n';
            
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('conversation_')) {
                    const messages = JSON.parse(localStorage.getItem(key));
                    output += `${key}:\n`;
                    output += `  Messages count: ${messages.length}\n`;
                    if (messages.length > 0) {
                        output += `  First message: ${messages[0].senderName} -> ${messages[0].receiverName}\n`;
                        output += `  Last message: ${messages[messages.length-1].senderName} -> ${messages[messages.length-1].receiverName}\n`;
                    }
                    output += '\n';
                }
            });
            
            document.getElementById('output').textContent = output;
        }

        function testLeaderLogin() {
            // Simulate a leader login
            const leaderUser = {
                id: 'mayor_gasabo',
                firstName: 'Marie',
                lastName: 'Rwakazina',
                role: 'leader'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(leaderUser));
            
            let output = 'Simulated leader login. Now checking what conversations they should see:\n\n';
            
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('conversation_') && key.includes('mayor_gasabo')) {
                    output += `Found conversation: ${key}\n`;
                    const messages = JSON.parse(localStorage.getItem(key));
                    output += `  Has ${messages.length} messages\n`;
                }
            });
            
            document.getElementById('output').textContent = output;
        }

        function clearAllChat() {
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('conversation_') || key.startsWith('chat_')) {
                    localStorage.removeItem(key);
                }
            });
            localStorage.removeItem('chatDataCleaned');
            alert('All chat data cleared!');
        }
    </script>
</body>
</html>
