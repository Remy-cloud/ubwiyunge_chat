<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug LocalStorage</title>
</head>
<body>
    <h1>LocalStorage Debug</h1>
    <button onclick="showLocalStorage()">Show All LocalStorage Data</button>
    <button onclick="clearChatData()">Clear Chat Data</button>
    <button onclick="createTestData()">Create Test Data</button>
    
    <div id="output" style="margin-top: 20px; white-space: pre-wrap; font-family: monospace;"></div>

    <script>
        function showLocalStorage() {
            const output = document.getElementById('output');
            let result = 'LocalStorage Contents:\n\n';
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                result += `${key}: ${value}\n\n`;
            }
            
            output.textContent = result;
        }

        function clearChatData() {
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.startsWith('conversation_') || key.startsWith('chat_')) {
                    localStorage.removeItem(key);
                }
            });
            alert('Chat data cleared!');
        }

        function createTestData() {
            // Simulate citizen user
            localStorage.setItem('currentUser', JSON.stringify({
                id: 'citizen_123',
                firstName: 'John',
                lastName: 'Citizen', 
                role: 'citizen'
            }));

            // Create test conversation
            const message = {
                id: Date.now(),
                senderId: 'citizen_123',
                senderName: 'John Citizen',
                senderRole: 'citizen',
                receiverId: 'mayor_gasabo',
                receiverName: 'Marie Chantal Rwakazina',
                receiverRole: 'leader',
                text: 'Hello Mayor, I have a question about road repairs.',
                timestamp: new Date().toISOString()
            };

            const conversationId = 'conversation_citizen_123_mayor_gasabo';
            localStorage.setItem(conversationId, JSON.stringify([message]));

            alert('Test data created!');
        }
    </script>
</body>
</html>
